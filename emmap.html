<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Module emmap</title>
<link rel="stylesheet" type="text/css" href="stylesheet.css" title="EDoc">
</head>
<body bgcolor="white">
<div class="navbar"><a name="#navbar_top"></a><table width="100%" border="0" cellspacing="0" cellpadding="2" summary="navigation bar"><tr><td><a href="overview-summary.html" target="overviewFrame">Overview</a></td><td><a href="http://www.erlang.org/"><img src="erlang.png" align="right" border="0" alt="erlang logo"></a></td></tr></table></div>
<hr>

<h1>Module emmap</h1>
<ul class="index"><li><a href="#types">Data Types</a></li><li><a href="#index">Function Index</a></li><li><a href="#functions">Function Details</a></li></ul>


<h2><a name="types">Data Types</a></h2>

<h3 class="typedecl"><a name="type-mmap_file">mmap_file()</a></h3>
<p><tt>mmap_file() = #file_descriptor{}</tt></p>


<h3 class="typedecl"><a name="type-open_option">open_option()</a></h3>
<p><tt>open_option() = anon | auto_unlink | create | debug | direct | fixed | lock | nocache | nolock | noreserve | populate | private | read | shared | shared_validate | sync | truncate | uninitialized | write | {address, pos_integer()} | {chmod, pos_integer()} | {size, pos_integer()}</tt></p>
<p><p>  Options for opening a memory mapped file:</p>
 
  <dl>
    <dt>anon</dt>
     <dd>Anonymous mapping. The mapping is not backed by any file;
         its contents are initialized to zero. The offset argument should be zero.</dd>
    <dt>auto_unlink</dt>
     <dd>Automatically delete the mapped file after the mapped data was garbage collected.
         This can be used when the mapped file is a file-based shared-memory area (e.g. <code>/dev/shm/...</code>)
         and is mapped in <code>direct</code> mode to free the memory after the data was gc'd</dd>
    <dt>create</dt>
     <dd>Allow to create mmap file if it doesn't exist.</dd>
    <dt>debug</dt>
     <dd>Turn on debug printing in the NIF library.</dd>
    <dt>direct</dt>
     <dd>Read/pread operations do not copy memory, but rather use "resource binaries" that
         can change content if the underlying data is changed.  This is the most performant,
         but also has other thread-safety implications when not using atomic operations.</dd>
    <dt>fixed</dt>
     <dd>Don't interpret addr as a hint: place the mapping at exactly that address.
         The implementation aligns the given address to a multiple of the page size.</dd>
    <dt>lock</dt>
     <dd>Use a semaphore (read/write lock) to control state changes internally in the NIF
         library. This is the default option.</dd>
    <dt>nocache</dt>
     <dd>Pages in this mapping are not retained in the kernel's memory cache.
         If the system runs low on memory, pages in MAP_NOCACHE mappings will be among the
         first to be reclaimed. NOTE: this option is only valid for Mac OS.</dd>
    <dt>nolock</dt>
     <dd>Don't use a semaphore (read/write lock) to control state changes internally in the NIF library</dd>
    <dt>noreserve</dt>
     <dd>Do not reserve swap space for this mapping.  When swap space is reserved, one has
         the guarantee that it is possible to modify the mapping.</dd>
    <dt>populate</dt>
     <dd>Populate (prefault) page tables for a mapping.  For a file mapping, this causes
         read-ahead on the file.  This will help to reduce blocking on page faults later.</dd>
    <dt>private</dt>
     <dd>Create a private copy-on-write mapping.  Updates to the mapping are not visible to
         other processes mapping the same file, and are not carried through to the underlying
         file.</dd>
    <dt>read</dt>
     <dd>Open for reading (this is default).</dd>
    <dt>shared</dt>
     <dd>Share this mapping.  Updates to the mapping are visible to other processes mapping
         the same region, and (in the case of file-backed mappings) are carried through to
         the underlying file. May be used in combination with <code>sync</code> to precisely control when
         updates are carried through to the underlying file.</dd>
    <dt>shared_validate</dt>
     <dd>This flag provides the same behavior as <code>shared</code> except that <code>shared</code> mappings ignore
         unknown flags in flags.  By contrast, when creating a mapping using <code>shared_validate</code>,
         the kernel verifies all passed flags are known and fails the mapping with the error
         <code>eopnotsupp</code> for unknown flags.  This mapping type is also required to be able to use
         some mapping flags (e.g., <code>sync</code>)</dd>
    <dt>sync</dt>
     <dd>This flag is available only with the <code>shared_validate</code> mapping type; mappings of type
         <code>shared</code> will silently ignore this flag.  This flag is supported only for files
         supporting DAX (direct mapping of persistent memory).  For other files, creating a
         mapping with this flag results in an <code>eopnotsupp</code> error.
         Shared file mappings with this flag provide the guarantee that while some memory is
         mapped writable in the address space of the process, it will be visible in the same
         file at the same offset even after the system crashes or is rebooted.  In conjunction
         with the use of appropriate CPU instructions, this provides users of such mappings
         with a more efficient way of making data modifications persistent.</dd>
    <dt>truncate</dt>
     <dd>Truncate existing mmap file after it's open.</dd>
    <dt>uninitialized</dt>
     <dd>Don't clear anonymous pages.  This flag is intended to improve performance on
         embedded devices.  This flag is honored only if the kernel was configured with
         the <code>CONFIG_MMAP_ALLOW_UNINITIALIZED</code> option.</dd>
    <dt>write</dt>
     <dd>Open memory map for writing.</dd>
    <dt>{address, pos_integer()}</dt>
     <dd>Open mapping at the given memory address (sets <code>MAP_FIXED</code> on the memory mapped file)</dd>
    <dt>{chmod,   pos_integer()}</dt>
     <dd>Create mmap file with this mode (default: <code>0600</code>)</dd>
    <dt>{size,    pos_integer()}</dt>
     <dd>Create/access memory map on this size.</dd>
 
  </dl></p>

<h3 class="typedecl"><a name="type-resource">resource()</a></h3>
<p><tt>resource() = binary()</tt></p>


<h2><a name="index">Function Index</a></h2>
<table width="100%" border="1" cellspacing="0" cellpadding="2" summary="function index"><tr><td valign="top"><a href="#close-1">close/1</a></td><td></td></tr>
<tr><td valign="top"><a href="#close_counters-1">close_counters/1</a></td><td>Close persistent memory-mapped file previously open with <code>open_counters/2</code></td></tr>
<tr><td valign="top"><a href="#dec_counter-2">dec_counter/2</a></td><td>Decrement a counter number <code>CounterNum</code> in the mmap file by one and return old value.</td></tr>
<tr><td valign="top"><a href="#dec_counter-3">dec_counter/3</a></td><td>Decrement a counter number <code>CounterNum</code> in the mmap file by <code>Count</code> and return old value.</td></tr>
<tr><td valign="top"><a href="#inc_counter-2">inc_counter/2</a></td><td>Increment a counter number <code>CounterNum</code> in the mmap file by one and return old value.</td></tr>
<tr><td valign="top"><a href="#inc_counter-3">inc_counter/3</a></td><td>Increment a counter number <code>CounterNum</code> in the mmap file by <code>Count</code> and return old value.</td></tr>
<tr><td valign="top"><a href="#init-0">init/0</a></td><td></td></tr>
<tr><td valign="top"><a href="#open-2">open/2</a></td><td>Open/create a memory-mapped file.</td></tr>
<tr><td valign="top"><a href="#open-4">open/4</a></td><td>Open/create a memory-mapped file.</td></tr>
<tr><td valign="top"><a href="#open_counters-1">open_counters/1</a></td><td>Open a persistent memory-mapped file with space for one 64-bit integer counter.</td></tr>
<tr><td valign="top"><a href="#open_counters-2">open_counters/2</a></td><td>Open a persistent memory-mapped file with space for several 64-bit integer counters.</td></tr>
<tr><td valign="top"><a href="#patomic-4">patomic/4</a></td><td>Perform an atomic operation on a 64-bit integer value at given <code>Position</code>
  using specified argument <code>Value</code>.</td></tr>
<tr><td valign="top"><a href="#patomic_read_integer-2">patomic_read_integer/2</a></td><td>Perform an atomic load operation on a 64-bit integer value at given <code>Position</code>.</td></tr>
<tr><td valign="top"><a href="#patomic_write_integer-3">patomic_write_integer/3</a></td><td>Perform an atomic store operation of a 64-bit integer <code>Value</code> at given <code>Position</code>.</td></tr>
<tr><td valign="top"><a href="#position-2">position/2</a></td><td>Write <code>Data</code> bytes to a memory-mapped file at a given offset <code>At</code>.</td></tr>
<tr><td valign="top"><a href="#pread-3">pread/3</a></td><td>Read <code>Len</code> bytes from a memory-mapped file at a given offset <code>Off</code>.</td></tr>
<tr><td valign="top"><a href="#pwrite-3">pwrite/3</a></td><td>Write <code>Data</code> bytes to a memory-mapped file at a given offset <code>Off</code>.</td></tr>
<tr><td valign="top"><a href="#read-2">read/2</a></td><td>Read next <code>Len</code> bytes from a memory-mapped file.</td></tr>
<tr><td valign="top"><a href="#read_counter-2">read_counter/2</a></td><td></td></tr>
<tr><td valign="top"><a href="#read_line-1">read_line/1</a></td><td></td></tr>
<tr><td valign="top"><a href="#set_counter-3">set_counter/3</a></td><td>Set a counter number <code>CounterNum</code> in the mmap file and return the old value.</td></tr>
</table>

<h2><a name="functions">Function Details</a></h2>

<h3 class="function"><a name="close-1">close/1</a></h3>
<div class="spec">
<p><tt>close(File::<a href="#type-mmap_file">mmap_file()</a>) -&gt; ok</tt><br></p>
<p> </p>
</div>

<h3 class="function"><a name="close_counters-1">close_counters/1</a></h3>
<div class="spec">
<p><tt>close_counters(X1) -&gt; any()</tt></p>
<p> </p>
</div><p>Close persistent memory-mapped file previously open with <code>open_counters/2</code></p>

<h3 class="function"><a name="dec_counter-2">dec_counter/2</a></h3>
<div class="spec">
<p><tt>dec_counter(X1, CounterNum) -&gt; any()</tt></p>
<p> </p>
</div><p>Decrement a counter number <code>CounterNum</code> in the mmap file by one and return old value.</p>

<h3 class="function"><a name="dec_counter-3">dec_counter/3</a></h3>
<div class="spec">
<p><tt>dec_counter(X1, CounterNum, Count) -&gt; any()</tt></p>
<p> </p>
</div><p>Decrement a counter number <code>CounterNum</code> in the mmap file by <code>Count</code> and return old value.</p>

<h3 class="function"><a name="inc_counter-2">inc_counter/2</a></h3>
<div class="spec">
<p><tt>inc_counter(X1, CounterNum) -&gt; any()</tt></p>
<p> </p>
</div><p>Increment a counter number <code>CounterNum</code> in the mmap file by one and return old value.</p>

<h3 class="function"><a name="inc_counter-3">inc_counter/3</a></h3>
<div class="spec">
<p><tt>inc_counter(X1, CounterNum, Count) -&gt; any()</tt></p>
<p> </p>
</div><p>Increment a counter number <code>CounterNum</code> in the mmap file by <code>Count</code> and return old value.</p>

<h3 class="function"><a name="init-0">init/0</a></h3>
<div class="spec">
<p><tt>init() -&gt; any()</tt></p>
<p> </p>
</div>

<h3 class="function"><a name="open-2">open/2</a></h3>
<div class="spec">
<p><tt>open(FileName::string() | binary(), Options::[<a href="#type-open_option">open_option()</a>]) -&gt; {ok, <a href="#type-mmap_file">mmap_file()</a>} | {error, term()}</tt><br></p>
<p> </p>
</div><p>Open/create a memory-mapped file.
  If creating a new file, <code>[create, read, write, {size, N}]</code> options are required.
  For opening an existing file for writing <code>[read, write]</code> options are required.</p>

<h3 class="function"><a name="open-4">open/4</a></h3>
<div class="spec">
<p><tt>open(File::string() | binary(), Offset::pos_integer(), Length::pos_integer(), Options::[<a href="#type-open_option">open_option()</a>]) -&gt; {ok, <a href="#type-mmap_file">mmap_file()</a>} | {error, term()}</tt><br></p>
<p> </p>
</div><p>Open/create a memory-mapped file.
  If creating a new file, <code>[create, read, write]</code> options and the <code>Len</code> parameter
  are required.
  For opening an existing file for writing <code>[read, write]</code> options are required, and <code>Len</code>
  can be <code>0</code>.</p>

<h3 class="function"><a name="open_counters-1">open_counters/1</a></h3>
<div class="spec">
<p><tt>open_counters(Filename) -&gt; any()</tt></p>
<p> </p>
</div><p>Open a persistent memory-mapped file with space for one 64-bit integer counter</p>

<h3 class="function"><a name="open_counters-2">open_counters/2</a></h3>
<div class="spec">
<p><tt>open_counters(Filename, NumCounters) -&gt; any()</tt></p>
<p> </p>
</div><p>Open a persistent memory-mapped file with space for several 64-bit integer counters</p>

<h3 class="function"><a name="patomic-4">patomic/4</a></h3>
<div class="spec">
<p><tt>patomic(File::<a href="#type-mmap_file">mmap_file()</a>, Position::pos_integer(), Op::add | sub | 'band' | 'bor' | 'bxor' | xchg, Value::integer()) -&gt; OldValue::integer()</tt><br></p>
<p> </p>
</div><p>Perform an atomic operation on a 64-bit integer value at given <code>Position</code>
  using specified argument <code>Value</code>.  The function returns an old value at that
  location.  This function is thread-safe and can be used for implementing
  persistent counters.</p>

<h3 class="function"><a name="patomic_read_integer-2">patomic_read_integer/2</a></h3>
<div class="spec">
<p><tt>patomic_read_integer(File::<a href="#type-mmap_file">mmap_file()</a>, Position::pos_integer()) -&gt; Value::integer()</tt><br></p>
<p> </p>
</div><p>Perform an atomic load operation on a 64-bit integer value at given <code>Position</code>.
  This function is thread-safe and can be used for implementing persistent counters.</p>

<h3 class="function"><a name="patomic_write_integer-3">patomic_write_integer/3</a></h3>
<div class="spec">
<p><tt>patomic_write_integer(File::<a href="#type-mmap_file">mmap_file()</a>, Position::pos_integer(), Value::integer()) -&gt; ok</tt><br></p>
<p> </p>
</div><p>Perform an atomic store operation of a 64-bit integer <code>Value</code> at given <code>Position</code>.
  This function is thread-safe and can be used for implementing persistent counters.</p>

<h3 class="function"><a name="position-2">position/2</a></h3>
<div class="spec">
<p><tt>position(File::<a href="#type-mmap_file">mmap_file()</a>, Position::pos_integer() | {bof | cur | eof, Position::integer()}) -&gt; {ok, pos_integer()} | {error, term()}</tt><br></p>
<p> </p>
</div><p>Write <code>Data</code> bytes to a memory-mapped file at a given offset <code>At</code>.</p>

<h3 class="function"><a name="pread-3">pread/3</a></h3>
<div class="spec">
<p><tt>pread(File::<a href="#type-mmap_file">mmap_file()</a>, Offset::pos_integer(), Length::pos_integer()) -&gt; {ok, binary()} | {error, term()} | eof</tt><br></p>
<p> </p>
</div><p>Read <code>Len</code> bytes from a memory-mapped file at a given offset <code>Off</code>.</p>

<h3 class="function"><a name="pwrite-3">pwrite/3</a></h3>
<div class="spec">
<p><tt>pwrite(File::<a href="#type-mmap_file">mmap_file()</a>, Position::pos_integer(), Data::binary()) -&gt; ok | {error, term()}</tt><br></p>
<p> </p>
</div><p>Write <code>Data</code> bytes to a memory-mapped file at a given offset <code>Off</code>.</p>

<h3 class="function"><a name="read-2">read/2</a></h3>
<div class="spec">
<p><tt>read(File::<a href="#type-mmap_file">mmap_file()</a>, Length::pos_integer()) -&gt; {ok, binary()} | {error, term()} | eof</tt><br></p>
<p> </p>
</div><p>Read next <code>Len</code> bytes from a memory-mapped file.
  Internally the new position within the file is incremented by <code>Len</code>.</p>

<h3 class="function"><a name="read_counter-2">read_counter/2</a></h3>
<div class="spec">
<p><tt>read_counter(X1, CounterNum) -&gt; any()</tt></p>
<p> </p>
</div>

<h3 class="function"><a name="read_line-1">read_line/1</a></h3>
<div class="spec">
<p><tt>read_line(File::<a href="#type-mmap_file">mmap_file()</a>) -&gt; {ok, binary()} | {error, term()} | eof</tt><br></p>
<p> </p>
</div>

<h3 class="function"><a name="set_counter-3">set_counter/3</a></h3>
<div class="spec">
<p><tt>set_counter(X1, CounterNum, Value) -&gt; any()</tt></p>
<p> </p>
</div><p>Set a counter number <code>CounterNum</code> in the mmap file and return the old value.</p>
<hr>

<div class="navbar"><a name="#navbar_bottom"></a><table width="100%" border="0" cellspacing="0" cellpadding="2" summary="navigation bar"><tr><td><a href="overview-summary.html" target="overviewFrame">Overview</a></td><td><a href="http://www.erlang.org/"><img src="erlang.png" align="right" border="0" alt="erlang logo"></a></td></tr></table></div>
<p><i>Generated by EDoc</i></p>
</body>
</html>
